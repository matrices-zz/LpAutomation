<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:LpAutomation.Desktop.Avalonia.Converters"
        xmlns:vm="clr-namespace:LpAutomation.Desktop.Avalonia.ViewModels"
        xmlns:views="clr-namespace:LpAutomation.Desktop.Avalonia.Views"
        x:Class="LpAutomation.Desktop.Avalonia.Views.MainWindow"
        Width="1240"
        Height="800"
        MinWidth="1080"
        MinHeight="700"
        Title="{Binding Title}"
        Background="{StaticResource AppBackgroundBrush}">

	<Window.Resources>
		<conv:StatusKindToBrushConverter x:Key="StatusKindToBrushConverter" />
		<conv:StatusKindToLabelConverter x:Key="StatusKindToLabelConverter" />


	</Window.Resources>

	<!-- Phase 2.0 page mapping -->
	<Window.DataTemplates>
		<DataTemplate DataType="vm:TrackPageViewModel">
			<views:TrackPageView />
		</DataTemplate>
		<DataTemplate DataType="vm:RecommendationsPageViewModel">
			<views:RecommendationsPageView />
		</DataTemplate>
		<DataTemplate DataType="vm:PaperPositionsPageViewModel">
			<views:PaperPositionsPageView />
		</DataTemplate>
	</Window.DataTemplates>

	<Window.Styles>
		<!-- Status chip soft transition -->
		<Style Selector="Border#StatusChip">
			<Setter Property="Opacity" Value="1" />
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Opacity" Duration="0:0:0.18"/>
				</Transitions>
			</Setter>
		</Style>
	</Window.Styles>

	<Grid RowDefinitions="Auto,*" ColumnDefinitions="300,*">

		<!-- Top bar -->
		<Border Grid.Row="0"
				Grid.ColumnSpan="2"
				Background="{StaticResource BrandPrimaryBrush}"
				Padding="18,12">
			<Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="10" VerticalAlignment="Center">
				<TextBlock Grid.Column="0"
						   Text="{Binding CurrentPageTitle}"
						   FontSize="22"
						   FontWeight="SemiBold"
						   Foreground="White"
						   VerticalAlignment="Center"/>

				<!-- keep bound to command that already exists in ShellViewModel -->
				<Button Grid.Column="1"
						Content="{Binding TestApiButtonText}"
						Command="{Binding TestApiCommand}"
						Margin="14,0,0,0"
						Padding="16,9"
						FontWeight="SemiBold"/>

				<Ellipse Grid.Column="2"
						 Width="10"
						 Height="10"
						 Fill="{Binding StatusKind, Converter={StaticResource StatusKindToBrushConverter}}"
						 VerticalAlignment="Center"
						 Margin="4,0,0,0" />

				<TextBlock Grid.Column="3"
						   VerticalAlignment="Center"
						   Foreground="White"
						   FontWeight="SemiBold"
						   Text="{Binding StatusKind, Converter={StaticResource StatusKindToLabelConverter}}"/>
			</Grid>
		</Border>

		<!-- Left nav -->
		<Border Grid.Row="1"
				Grid.Column="0"
				Background="{StaticResource PanelBackgroundBrush}"
				BorderBrush="{StaticResource PanelBorderBrush}"
				BorderThickness="0,1,1,0"
				Padding="14">
			<StackPanel Spacing="10">
				<TextBlock Text="LP Automation"
						   FontSize="20"
						   FontWeight="SemiBold"
						   Foreground="{StaticResource TextPrimaryBrush}" />

				<TextBlock Text="{Binding Subtitle}"
						   Foreground="{StaticResource TextMutedBrush}"
						   Margin="0,0,0,14"/>

				<ItemsControl ItemsSource="{Binding NavItems}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Button Command="{Binding DataContext.NavigateCommand, RelativeSource={RelativeSource AncestorType=Window}}"
									CommandParameter="{Binding}"
									HorizontalAlignment="Stretch"
									Margin="0,4,0,0"
									Padding="12,10">
								<TextBlock Text="{Binding Title}" />
							</Button>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</StackPanel>
		</Border>

		<!-- Main content -->
		<Border Grid.Row="1"
				Grid.Column="1"
				BorderBrush="{StaticResource PanelBorderBrush}"
				BorderThickness="0,1,0,0"
				Padding="22"
				MinHeight="0">
			<Grid RowDefinitions="Auto,*"
				  RowSpacing="14"
				  MinHeight="0">

				<TextBlock Grid.Row="0"
					   Text="{Binding CurrentPageTitle}"
					   FontSize="30"
					   FontWeight="SemiBold"
					   Foreground="{StaticResource TextPrimaryBrush}" />
				<Window xmlns="https://github.com/avaloniaui"
						xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
						xmlns:conv="clr-namespace:LpAutomation.Desktop.Avalonia.Converters"
						xmlns:vm="clr-namespace:LpAutomation.Desktop.Avalonia.ViewModels"
						xmlns:views="clr-namespace:LpAutomation.Desktop.Avalonia.Views"
						x:Class="LpAutomation.Desktop.Avalonia.Views.MainWindow"
						Width="1240"
						Height="800"
						MinWidth="1080"
						MinHeight="700"
						Title="{Binding Title}"
						Background="{StaticResource AppBackgroundBrush}">

					<Window.Resources>
						<conv:StatusKindToBrushConverter x:Key="StatusKindToBrushConverter" />
						<conv:StatusKindToLabelConverter x:Key="StatusKindToLabelConverter" />


					</Window.Resources>

					<!-- Phase 2.0 page mapping -->
					<Window.DataTemplates>
						<DataTemplate DataType="vm:TrackPageViewModel">
							<views:TrackPageView />
						</DataTemplate>
						<DataTemplate DataType="vm:RecommendationsPageViewModel">
							<views:RecommendationsPageView />
						</DataTemplate>
						<DataTemplate DataType="vm:PaperPositionsPageViewModel">
							<views:PaperPositionsPageView />
						</DataTemplate>
						<DataTemplate DataType="vm:SettingsPageViewModel">
							<views:SettingsPageView />
						</DataTemplate>
					</Window.DataTemplates>

					<Window.Styles>
						<!-- Status chip soft transition -->
						<Style Selector="Border#StatusChip">
							<Setter Property="Opacity" Value="1" />
							<Setter Property="Transitions">
								<Transitions>
									<DoubleTransition Property="Opacity" Duration="0:0:0.18"/>
								</Transitions>
							</Setter>
						</Style>
					</Window.Styles>

					<Grid RowDefinitions="Auto,*" ColumnDefinitions="300,*">

						<!-- Top bar -->
						<Border Grid.Row="0"
								Grid.ColumnSpan="2"
								Background="{StaticResource BrandPrimaryBrush}"
								Padding="18,12">
							<Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="10" VerticalAlignment="Center">
								<TextBlock Grid.Column="0"
										   Text="{Binding CurrentPageTitle}"
										   FontSize="22"
										   FontWeight="SemiBold"
										   Foreground="White"
										   VerticalAlignment="Center"/>

								<!-- keep bound to command that already exists in ShellViewModel -->
								<Button Grid.Column="1"
										Content="{Binding TestApiButtonText}"
										Command="{Binding TestApiCommand}"
										Margin="14,0,0,0"
										Padding="16,9"
										FontWeight="SemiBold"/>

								<Ellipse Grid.Column="2"
										 Width="10"
										 Height="10"
										 Fill="{Binding StatusKind, Converter={StaticResource StatusKindToBrushConverter}}"
										 VerticalAlignment="Center"
										 Margin="4,0,0,0" />

								<TextBlock Grid.Column="3"
										   VerticalAlignment="Center"
										   Foreground="White"
										   FontWeight="SemiBold"
										   Text="{Binding StatusKind, Converter={StaticResource StatusKindToLabelConverter}}"/>
							</Grid>
						</Border>

						<!-- Left nav -->
						<Border Grid.Row="1"
								Grid.Column="0"
								Background="{StaticResource PanelBackgroundBrush}"
								BorderBrush="{StaticResource PanelBorderBrush}"
								BorderThickness="0,1,1,0"
								Padding="14">
							<StackPanel Spacing="10">
								<TextBlock Text="LP Automation"
										   FontSize="20"
										   FontWeight="SemiBold"
										   Foreground="{StaticResource TextPrimaryBrush}" />

								<TextBlock Text="{Binding Subtitle}"
										   Foreground="{StaticResource TextMutedBrush}"
										   Margin="0,0,0,14"/>

								<ItemsControl ItemsSource="{Binding NavItems}">
									<ItemsControl.ItemTemplate>
										<DataTemplate>
											<Button Command="{Binding DataContext.NavigateCommand, RelativeSource={RelativeSource AncestorType=Window}}"
													CommandParameter="{Binding}"
													HorizontalAlignment="Stretch"
													Margin="0,4,0,0"
													Padding="12,10">
												<TextBlock Text="{Binding Title}" />
											</Button>
										</DataTemplate>
									</ItemsControl.ItemTemplate>
								</ItemsControl>
							</StackPanel>
						</Border>

						<!-- Main content -->
						<Border Grid.Row="1"
								Grid.Column="1"
								BorderBrush="{StaticResource PanelBorderBrush}"
								BorderThickness="0,1,0,0"
								Padding="22"
								MinHeight="0">
							<Grid RowDefinitions="Auto,*"
								  RowSpacing="14"
								  MinHeight="0">

								<TextBlock Grid.Row="0"
									   Text="{Binding CurrentPageTitle}"
									   FontSize="30"
									   FontWeight="SemiBold"
									   Foreground="{StaticResource TextPrimaryBrush}" />

								<!-- Phase 2.0: dynamic page host (replaces static JSON panel) -->
								<Border Grid.Row="1"
										Background="{StaticResource JsonPanelBrush}"
										BorderBrush="{StaticResource JsonBorderBrush}"
										BorderThickness="1"
										CornerRadius="10"
										Padding="12"
										MinHeight="0">
									<ContentControl Content="{Binding CurrentPage}" />
								</Border>

							</Grid>
						</Border>

					</Grid>
				</Window>

				<!-- Phase 2.0: dynamic page host (replaces static JSON panel) -->
				<Border Grid.Row="1"
						Background="{StaticResource JsonPanelBrush}"
						BorderBrush="{StaticResource JsonBorderBrush}"
						BorderThickness="1"
						CornerRadius="10"
						Padding="12"
						MinHeight="0">
					<ContentControl Content="{Binding CurrentPage}" />
				</Border>

			</Grid>
		</Border>

	</Grid>
</Window>
