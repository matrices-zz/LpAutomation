<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:LpAutomation.Desktop.Avalonia.Converters"
        x:Class="LpAutomation.Desktop.Avalonia.Views.MainWindow"
        Width="1200"
        Height="760"
        Title="{Binding Title}"
        Background="{StaticResource AppBackgroundBrush}">

	<Window.Resources>
		<conv:StatusKindToBrushConverter x:Key="StatusKindToBrushConverter" />
	</Window.Resources>

	<Window.Resources>
		<conv:StatusKindToLabelConverter x:Key="StatusKindToLabelConverter" />
	</Window.Resources>

	<Grid RowDefinitions="Auto,*" ColumnDefinitions="280,*">

		<!-- Top bar -->
		<Border Grid.Row="0"
				Grid.ColumnSpan="2"
				Background="{StaticResource BrandPrimaryBrush}"
				Padding="16,10">
			<Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
				<TextBlock Grid.Column="0"
						   Text="{Binding CurrentPageTitle}"
						   FontSize="20"
						   FontWeight="SemiBold"
						   Foreground="White"
						   VerticalAlignment="Center"/>

				<Button Grid.Column="1"
						Content="Test API"
						Command="{Binding TestApiCommand}"
						Margin="12,0,0,0"
						Padding="14,8"/>
			</Grid>
		</Border>

		<!-- Left nav -->
		<Border Grid.Row="1"
				Grid.Column="0"
				Background="{StaticResource PanelBackgroundBrush}"
				BorderBrush="{StaticResource PanelBorderBrush}"
				BorderThickness="0,1,1,0"
				Padding="12">
			<StackPanel Spacing="8">
				<TextBlock Text="LP Automation"
						   FontSize="18"
						   FontWeight="SemiBold"
						   Foreground="{StaticResource TextPrimaryBrush}" />

				<TextBlock Text="{Binding Subtitle}"
						   Foreground="{StaticResource TextMutedBrush}"
						   Margin="0,0,0,12"/>

				<ItemsControl ItemsSource="{Binding NavItems}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Button Command="{Binding DataContext.NavigateCommand, RelativeSource={RelativeSource AncestorType=Window}}"
									CommandParameter="{Binding}"
									HorizontalAlignment="Stretch"
									Margin="0,4,0,0">
								<TextBlock Text="{Binding Title}" />
							</Button>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</StackPanel>
		</Border>

		<!-- Main content -->
		<Border Grid.Row="1"
        Grid.Column="1"
        BorderBrush="{StaticResource PanelBorderBrush}"
        BorderThickness="0,1,0,0"
        Padding="20">
			<StackPanel Spacing="12">

				<TextBlock Text="{Binding CurrentPageTitle}"
						   FontSize="28"
						   FontWeight="SemiBold"
						   Foreground="{StaticResource TextPrimaryBrush}" />

				<!-- KPI strip -->
				<Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="10">
					<Border Grid.Column="0"
							Background="{StaticResource KpiCardBrush}"
							BorderBrush="{StaticResource KpiBorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Padding="10">
						<StackPanel>
							<TextBlock Text="Calls" Foreground="{StaticResource TextMutedBrush}" />
							<TextBlock Text="{Binding ApiCallCount}" FontSize="22" FontWeight="SemiBold" />
						</StackPanel>
					</Border>

					<Border Grid.Column="1"
							Background="{StaticResource KpiCardBrush}"
							BorderBrush="{StaticResource KpiBorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Padding="10">
						<StackPanel>
							<TextBlock Text="Errors" Foreground="{StaticResource TextMutedBrush}" />
							<TextBlock Text="{Binding ApiErrorCount}" FontSize="22" FontWeight="SemiBold" />
						</StackPanel>
					</Border>

					<Border Grid.Column="2"
							Background="{StaticResource KpiCardBrush}"
							BorderBrush="{StaticResource KpiBorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Padding="10">
						<StackPanel>
							<TextBlock Text="Payload" Foreground="{StaticResource TextMutedBrush}" />
							<TextBlock Text="{Binding LastPayloadChars, StringFormat='{}{0} chars'}" FontSize="22" FontWeight="SemiBold" />
						</StackPanel>
					</Border>

					<Border Grid.Column="3"
							Background="{StaticResource KpiCardBrush}"
							BorderBrush="{StaticResource KpiBorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Padding="10">
						<StackPanel>
							<TextBlock Text="Latency" Foreground="{StaticResource TextMutedBrush}" />
							<TextBlock Text="{Binding LastElapsedMs, StringFormat='{}{0:F0} ms'}" FontSize="22" FontWeight="SemiBold" />
						</StackPanel>
					</Border>
				</Grid>

				<!-- status card -->
				<Border Background="{StaticResource PanelBackgroundBrush}"
						BorderBrush="{StaticResource PanelBorderBrush}"
						BorderThickness="1"
						CornerRadius="8"
						Padding="12">
					<Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto,Auto">
						<Ellipse Width="10"
								 Height="10"
								 Fill="{Binding StatusKind, Converter={StaticResource StatusKindToBrushConverter}}"
								 VerticalAlignment="Center"
								 Margin="0,0,10,0"/>

						<Border Grid.Column="1"
								Background="{Binding StatusKind, Converter={StaticResource StatusKindToBrushConverter}}"
								CornerRadius="10"
								Padding="8,2"
								Margin="0,0,10,0">
							<TextBlock Text="{Binding StatusKind, Converter={StaticResource StatusKindToLabelConverter}}"
									   FontWeight="SemiBold"
									   Foreground="Black"/>
						</Border>

						<TextBlock Grid.Column="2"
								   Text="{Binding StatusMessage}"
								   FontSize="14"
								   VerticalAlignment="Center"
								   Foreground="{StaticResource TextPrimaryBrush}" />

						<TextBlock Grid.Row="1"
								   Grid.ColumnSpan="3"
								   Margin="0,8,0,0"
								   Text="{Binding LastUpdatedUtc, StringFormat='Last Updated (UTC): {0}'}"
								   Foreground="{StaticResource TextMutedBrush}" />
					</Grid>
				</Border>

				<!-- JSON preview -->
				<Border Background="{StaticResource JsonPanelBrush}"
						BorderBrush="{StaticResource JsonBorderBrush}"
						BorderThickness="1"
						CornerRadius="8"
						Padding="12">
					<StackPanel Spacing="8">
						<TextBlock Text="{Binding PreviewTitle}"
								   FontSize="16"
								   FontWeight="SemiBold"
								   Foreground="{StaticResource TextPrimaryBrush}" />

						<ScrollViewer Height="360">
							<TextBlock Text="{Binding LastApiPreview}"
									   TextWrapping="Wrap"
									   FontFamily="Consolas"
									   Foreground="{StaticResource JsonTextBrush}" />
						</ScrollViewer>
					</StackPanel>
				</Border>

			</StackPanel>
		</Border>


	</Grid>

</Window>
