<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="LpAutomation.Desktop.Avalonia.Views.RecommendationsPageView"
             x:Name="Root"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch">

	<Grid RowDefinitions="Auto,Auto,*"
		  RowSpacing="10"
		  HorizontalAlignment="Stretch"
		  VerticalAlignment="Stretch"
		  MinHeight="0"
		  ClipToBounds="True">

		<!-- Discover controls -->
		<Border Grid.Row="0"
				Background="{StaticResource PanelBackgroundBrush}"
				BorderBrush="{StaticResource PanelBorderBrush}"
				BorderThickness="1"
				CornerRadius="8"
				Padding="10">
			<Grid RowDefinitions="Auto,Auto" RowSpacing="8">
				<Grid ColumnDefinitions="Auto,280,180,170,170,*,Auto" ColumnSpacing="8">
					<Button Grid.Column="0"
							Content="Refresh"
							Command="{Binding RefreshCommand}" />

					<TextBox Grid.Column="1"
							 Watermark="Search pools, token, address..."
							 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

					<ComboBox Grid.Column="2"
							  ItemsSource="{Binding ChainOptions}"
							  SelectedItem="{Binding SelectedChain}" />

					<ComboBox Grid.Column="3"
							  ItemsSource="{Binding RegimeOptions}"
							  SelectedItem="{Binding SelectedRegime}" />

					<ComboBox Grid.Column="4"
							  ItemsSource="{Binding TimeframeOptions}"
							  SelectedItem="{Binding SelectedTimeframe}" />

					<TextBlock Grid.Column="5"
							   VerticalAlignment="Center"
							   Text="{Binding Status}" />

					<Button Grid.Column="6"
							Content="Reset"
							Command="{Binding ResetFiltersCommand}" />
				</Grid>

				<Grid Grid.Row="1" RowDefinitions="Auto,Auto" RowSpacing="6">
					<Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="8">
						<TextBlock Grid.Column="0"
								   VerticalAlignment="Center"
								   Text="{Binding CountLabel}" />

						<Grid Grid.Column="1" Width="320">
							<ToggleButton x:Name="DexToggleAnchor" Content="{Binding SelectedDexSummary}"
										  IsChecked="{Binding IsDexSelectorOpen}"
										  HorizontalAlignment="Stretch" />

							<Popup IsOpen="{Binding IsDexSelectorOpen}"
									 Placement="Bottom"
									 PlacementTarget="{Binding #DexToggleAnchor}"
									 Width="360">
								<Border Background="#1D2230" BorderBrush="#323848" BorderThickness="1" CornerRadius="8" Padding="8">
									<Grid RowDefinitions="Auto,*" RowSpacing="8" MinHeight="0">
										<Grid ColumnDefinitions="Auto,Auto,*" ColumnSpacing="6">
											<Button Grid.Column="0" Content="All" Command="{Binding SelectAllDexesCommand}" />
											<Button Grid.Column="1" Content="Clear" Command="{Binding ClearDexesCommand}" />
											<Button Grid.Column="2" HorizontalAlignment="Right" Content="Done" Command="{Binding ToggleDexSelectorCommand}" />
										</Grid>

										<ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MinHeight="220" MaxHeight="280">
											<ItemsControl ItemsSource="{Binding DexFilterOptions}">
												<ItemsControl.ItemTemplate>
													<DataTemplate>
														<CheckBox Content="{Binding Name}" IsChecked="{Binding IsSelected}" Margin="0,2,0,2"/>
													</DataTemplate>
												</ItemsControl.ItemTemplate>
											</ItemsControl>
										</ScrollViewer>
									</Grid>
								</Border>
							</Popup>
						</Grid>

						<ComboBox Grid.Column="2"
								  Width="190"
								  ItemsSource="{Binding SortOptions}"
								  SelectedItem="{Binding SelectedSort}" />

						<Button Grid.Column="3"
								Content="Reset Sort"
								Command="{Binding ResetSortCommand}" />
					</Grid>

					<ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
						<StackPanel Orientation="Horizontal" Spacing="6">
							<TextBlock Text="Presets:" VerticalAlignment="Center" Foreground="{StaticResource TextMutedBrush}"/>
							<Button Content="All Opportunities" Command="{Binding SetPresetCommand}" CommandParameter="All Opportunities"/>
							<Button Content="High Reinvest" Command="{Binding SetPresetCommand}" CommandParameter="High Reinvest (&gt;=70)"/>
							<Button Content="High Reallocate" Command="{Binding SetPresetCommand}" CommandParameter="High Reallocate (&gt;=70)"/>
							<Button Content="Trending + Low Fee" Command="{Binding SetPresetCommand}" CommandParameter="Trending + Low Fee"/>
							<Button Content="Updated 24h" Command="{Binding SetPresetCommand}" CommandParameter="Recently Updated (24h)"/>
							<TextBlock Text="{Binding SelectedPreset}" VerticalAlignment="Center" Margin="8,0,0,0"/>
						</StackPanel>
					</ScrollViewer>
				</Grid>
			</Grid>
		</Border>

		<Border Grid.Row="1"
				Background="#20242C"
				BorderBrush="#323848"
				BorderThickness="1"
				CornerRadius="8"
				Padding="10">
			<TextBlock Text="Discover opportunities across DEXs/chains and send winning pools to Simulate."
					   Foreground="{StaticResource TextMutedBrush}" />
		</Border>

		<Border Grid.Row="2"
				Background="#20242C"
				BorderBrush="#323848"
				BorderThickness="1"
				CornerRadius="8"
				Padding="10"
				MinHeight="0"
				ClipToBounds="True">

			<Grid MinHeight="0" RowDefinitions="*">
				<DataGrid Grid.Row="0"
						  ItemsSource="{Binding FilteredRows}"
						  IsReadOnly="True"
						  AutoGenerateColumns="False"
						  CanUserResizeColumns="True"
						  CanUserSortColumns="True"
						  HeadersVisibility="Column"
						  GridLinesVisibility="None"
						  HorizontalAlignment="Stretch"
						  VerticalAlignment="Stretch"
						  ScrollViewer.HorizontalScrollBarVisibility="Auto"
						  ScrollViewer.VerticalScrollBarVisibility="Visible"
						  ScrollViewer.AllowAutoHide="False"
						  MinHeight="0"
						  RowHeight="46"
						  BorderThickness="0"
						  Background="Transparent">

					<DataGrid.Styles>
						<Style Selector="DataGridColumnHeader">
							<Setter Property="FontWeight" Value="SemiBold" />
							<Setter Property="HorizontalContentAlignment" Value="Center" />
						</Style>
						<Style Selector="DataGridCell">
							<Setter Property="Padding" Value="10,8" />
						</Style>
						<Style Selector="DataGridRow">
							<Setter Property="Margin" Value="0,2" />
						</Style>
						<Style Selector="DataGrid ScrollBar:vertical">
							<Setter Property="IsVisible" Value="True" />
							<Setter Property="Width" Value="14" />
							<Setter Property="Opacity" Value="1" />
							<Setter Property="Background" Value="#202938" />
						</Style>
						<Style Selector="DataGrid ScrollBar:horizontal">
							<Setter Property="Height" Value="14" />
							<Setter Property="Opacity" Value="1" />
							<Setter Property="Background" Value="#202938" />
						</Style>
						<Style Selector="DataGrid ScrollBar /template/ Thumb">
							<Setter Property="Background" Value="#A8C0E8" />
							<Setter Property="MinHeight" Value="28" />
							<Setter Property="MinWidth" Value="28" />
							<Setter Property="CornerRadius" Value="7" />
							<Setter Property="Opacity" Value="1" />
						</Style>
					</DataGrid.Styles>

					<DataGrid.Columns>
						<DataGridTextColumn Header="Pool" Width="1.2*" MinWidth="170" Binding="{Binding Pool}" />
						<DataGridTextColumn Header="DEX" Width="Auto" MinWidth="120" Binding="{Binding Dex}" />
						<DataGridTextColumn Header="Chain" Width="Auto" MinWidth="110" Binding="{Binding ChainLabel}" />
						<DataGridTextColumn Header="Fee" Width="Auto" MinWidth="85" Binding="{Binding FeeLabel}" />
						<DataGridTextColumn Header="Regime" Width="Auto" MinWidth="105" Binding="{Binding RegimeLabel}" />
						<DataGridTemplateColumn Header="Decision" Width="Auto" MinWidth="170">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Border Background="{Binding DecisionBrush}" CornerRadius="10" Padding="10,4" Margin="2,3"
											HorizontalAlignment="Center"
											VerticalAlignment="Center"
											ToolTip.Tip="{Binding DecisionConfidenceTooltip}"
											Width="118">
										<TextBlock Text="{Binding DecisionLabel}" TextAlignment="Center"
												   HorizontalAlignment="Center" VerticalAlignment="Center" />
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						<DataGridTemplateColumn Header="Reinvest" Width="Auto" MinWidth="110">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Border Background="{Binding ReinvestBrush}" CornerRadius="10" Padding="10,4" Margin="2,3"
										HorizontalAlignment="Center" VerticalAlignment="Center"
										ToolTip.Tip="{Binding ReinvestTooltip}"
											Width="64">
										<TextBlock Text="{Binding Reinvest}" TextAlignment="Center"
												   HorizontalAlignment="Center" VerticalAlignment="Center" />
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						<DataGridTemplateColumn Header="Reallocate" Width="Auto" MinWidth="115">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Border Background="{Binding ReallocateBrush}" CornerRadius="10" Padding="10,4" Margin="2,3"
										HorizontalAlignment="Center" VerticalAlignment="Center"
										ToolTip.Tip="{Binding ReallocateTooltip}"
											Width="64">
										<TextBlock Text="{Binding Reallocate}" TextAlignment="Center"
												   HorizontalAlignment="Center" VerticalAlignment="Center" />
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						<DataGridTemplateColumn Header="Market Heat" Width="Auto" MinWidth="95">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding MarketHeat}" ToolTip.Tip="{Binding MarketHeatTooltip}"
									   TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						<DataGridTemplateColumn Header="Opportunity" Width="Auto" MinWidth="100">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding OpportunityScore}" ToolTip.Tip="{Binding OpportunityTooltip}"
									   TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						<DataGridTemplateColumn Header="Summary" Width="2*" MinWidth="300">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Summary}"
											   TextWrapping="Wrap"
											   MaxLines="3"
											   TextTrimming="CharacterEllipsis"
											   ToolTip.Tip="Summary legend: T = Tactical (short-term setup), S = Strategic (swing/medium horizon), M = Macro (broad market regime), SM = Super Macro (long-horizon structural regime)." />
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						<DataGridTextColumn Header="Updated" Width="Auto" MinWidth="150" Binding="{Binding UpdatedLabel}" />

						<DataGridTemplateColumn Header="Action" Width="Auto" MinWidth="110">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Button Content="Simulate"
											Padding="10,4"
											Command="{Binding DataContext.SimulatePoolCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
											CommandParameter="{Binding PoolAddress}" />
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
					</DataGrid.Columns>
				</DataGrid>
			</Grid>
		</Border>
	</Grid>
</UserControl>
