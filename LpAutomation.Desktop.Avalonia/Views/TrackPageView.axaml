<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="LpAutomation.Desktop.Avalonia.Views.TrackPageView"
             x:Name="Root"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch">

	<Grid RowDefinitions="Auto,Auto,*"
		  RowSpacing="10"
		  HorizontalAlignment="Stretch"
		  VerticalAlignment="Stretch"
		  MinHeight="0"
		  ClipToBounds="True">

		<!-- Toolbar -->
		<Border Grid.Row="0"
				Background="{StaticResource PanelBackgroundBrush}"
				BorderBrush="{StaticResource PanelBorderBrush}"
				BorderThickness="1"
				CornerRadius="8"
				Padding="10">
			<Grid ColumnDefinitions="Auto,220,120,110,Auto,*"
				  ColumnSpacing="8"
				  HorizontalAlignment="Stretch">
				<Button Grid.Column="0"
						Content="Refresh"
						Command="{Binding RefreshCommand}" />

				<TextBox Grid.Column="1"
						 Text="{Binding OwnerTagFilter}"
						 Watermark="OwnerTag filter..."
						 HorizontalAlignment="Stretch" />

				<ComboBox Grid.Column="2"
						  ItemsSource="{Binding ChainOptions}"
						  SelectedItem="{Binding SelectedChain}"
						  HorizontalAlignment="Stretch" />

				<TextBox Grid.Column="3"
						 Text="{Binding RefreshIntervalSeconds}"
						 Watermark="Secs"
						 HorizontalAlignment="Stretch" />

				<Button Grid.Column="4"
						Content="{Binding AutoRefreshButtonLabel}"
						Command="{Binding ToggleAutoRefreshCommand}" />

				<TextBlock Grid.Column="5"
						   Margin="10,0,0,0"
						   VerticalAlignment="Center"
						   Text="{Binding StatusMessage}" />
			</Grid>
		</Border>

		<!-- KPI cards -->
		<Grid Grid.Row="1" ColumnDefinitions="*,*,*,*,*" ColumnSpacing="8">
			<Border Background="{StaticResource KpiCardBrush}" BorderBrush="{StaticResource KpiBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
				<StackPanel>
					<TextBlock Text="Active Pools" Foreground="{StaticResource TextMutedBrush}" />
					<TextBlock Text="{Binding ActivePoolsCount}" FontSize="22" FontWeight="SemiBold" />
				</StackPanel>
			</Border>

			<Border Grid.Column="1" Background="{StaticResource KpiCardBrush}" BorderBrush="{StaticResource KpiBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
				<StackPanel>
					<TextBlock Text="Simulation Positions" Foreground="{StaticResource TextMutedBrush}" />
					<TextBlock Text="{Binding PaperPositionsCount}" FontSize="22" FontWeight="SemiBold" />
				</StackPanel>
			</Border>

			<Border Grid.Column="2" Background="{StaticResource KpiCardBrush}" BorderBrush="{StaticResource KpiBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
				<StackPanel>
					<TextBlock Text="In-Range %" Foreground="{StaticResource TextMutedBrush}" />
					<TextBlock Text="{Binding InRangePct, StringFormat={}{0:0.0}}" FontSize="22" FontWeight="SemiBold" />
				</StackPanel>
			</Border>

			<Border Grid.Column="3" Background="{StaticResource KpiCardBrush}" BorderBrush="{StaticResource KpiBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
				<StackPanel>
					<TextBlock Text="Exposure USD" Foreground="{StaticResource TextMutedBrush}" />
					<TextBlock Text="{Binding EstimatedNetExposureUsd, StringFormat={}{0:N0}}" FontSize="22" FontWeight="SemiBold" />
				</StackPanel>
			</Border>

			<Border Grid.Column="4" Background="{StaticResource KpiCardBrush}" BorderBrush="{StaticResource KpiBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
				<StackPanel>
					<TextBlock Text="Warnings / Updated" Foreground="{StaticResource TextMutedBrush}" />
					<TextBlock Text="{Binding WarningCount}" FontSize="22" FontWeight="SemiBold" />
					<TextBlock Text="{Binding LastUpdatedUtc}" FontSize="11" />
				</StackPanel>
			</Border>
		</Grid>

		<Border x:Name="ResultsPane" Grid.Row="2"
				Background="#20242C"
				BorderBrush="#323848"
				BorderThickness="1"
				CornerRadius="8"
				Padding="10"
				MinHeight="0"
				ClipToBounds="True">

			<!-- Keep DataGrid constrained to this pane so scrollbars compute real extents -->
			<Grid x:Name="ResultsViewport" MinHeight="0" RowDefinitions="*">

				<DataGrid Grid.Row="0" ItemsSource="{Binding Rows}"
						  IsReadOnly="True"
						  AutoGenerateColumns="False"
						  CanUserResizeColumns="True"
						  CanUserSortColumns="False"
						  HeadersVisibility="Column"
						  GridLinesVisibility="None"
						  HorizontalAlignment="Stretch"
						  VerticalAlignment="Stretch"
						  ScrollViewer.HorizontalScrollBarVisibility="Auto"
						  ScrollViewer.VerticalScrollBarVisibility="Visible"
						  ScrollViewer.AllowAutoHide="False"
						  ScrollViewer.IsScrollChainingEnabled="False"
						  MinHeight="0"
						  RowHeight="42"
						  BorderThickness="0"
						  Background="Transparent">

					<DataGrid.Styles>
						<Style Selector="DataGridColumnHeader">
							<Setter Property="FontWeight" Value="SemiBold" />
						</Style>
						<Style Selector="DataGridCell">
							<Setter Property="Padding" Value="8,6" />
						</Style>

						<Style Selector="DataGrid ScrollBar:vertical">
							<Setter Property="IsVisible" Value="True" />
							<Setter Property="Width" Value="14" />
							<Setter Property="Opacity" Value="1" />
							<Setter Property="Background" Value="#202938" />
						</Style>
						<Style Selector="DataGrid /template/ ScrollBar:vertical">
							<Setter Property="IsVisible" Value="True" />
							<Setter Property="Width" Value="14" />
							<Setter Property="Opacity" Value="1" />
						</Style>
						<Style Selector="DataGrid ScrollBar:vertical:disabled">
							<Setter Property="IsVisible" Value="True" />
							<Setter Property="Opacity" Value="1" />
							<Setter Property="Background" Value="#253043" />
						</Style>
						<Style Selector="DataGrid ScrollBar:horizontal">
							<Setter Property="Height" Value="14" />
							<Setter Property="Opacity" Value="1" />
							<Setter Property="Background" Value="#202938" />
						</Style>
						<Style Selector="DataGrid ScrollBar /template/ Thumb">
							<Setter Property="Background" Value="#A8C0E8" />
							<Setter Property="MinHeight" Value="28" />
							<Setter Property="MinWidth" Value="28" />
							<Setter Property="CornerRadius" Value="7" />
							<Setter Property="Opacity" Value="1" />
						</Style>
						<Style Selector="DataGrid ScrollBar:vertical:disabled /template/ Thumb">
							<Setter Property="Background" Value="#637792" />
							<Setter Property="MinHeight" Value="28" />
							<Setter Property="CornerRadius" Value="7" />
							<Setter Property="Opacity" Value="1" />
						</Style>
					</DataGrid.Styles>

					<DataGrid.Columns>
						<DataGridTextColumn Header="Pair" Width="1*" MinWidth="130" Binding="{Binding Pair}" />

						<DataGridTemplateColumn Header="Pool" Width="1*" MinWidth="145">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Button Background="Transparent"
											BorderThickness="0"
											Padding="0"
											HorizontalAlignment="Left"
											Command="{Binding DataContext.OpenRecommendationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
											CommandParameter="{Binding PoolAddress}"
											ToolTip.Tip="{Binding PoolAddress}">
										<TextBlock Text="{Binding PoolAddressShort}"
												   FontFamily="Consolas"
												   TextTrimming="CharacterEllipsis" />
									</Button>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<DataGridTextColumn Header="Fee" Width="Auto" MinWidth="70" Binding="{Binding FeeTier}" />
						<DataGridTextColumn Header="Regime" Width="Auto" MinWidth="105" Binding="{Binding Regime}" />
						<DataGridTextColumn Header="Action" Width="Auto" MinWidth="115" Binding="{Binding RecommendationAction}" />
						<DataGridTextColumn Header="Paper Position" Width="1.4*" MinWidth="200" Binding="{Binding PaperPositionId}" />
						<DataGridTextColumn Header="Liq USD" Width="Auto" MinWidth="115" Binding="{Binding LiquidityUsd, StringFormat={}{0:N0}}" />
						<DataGridTextColumn Header="Exposure %" Width="Auto" MinWidth="105" Binding="{Binding EstimatedExposurePct, StringFormat={}{0:0.0}}" />
						<DataGridTextColumn Header="Status" Width="Auto" MinWidth="95" Binding="{Binding Status}" />
						<DataGridTextColumn Header="Diagnostics" Width="2.2*" MinWidth="320" Binding="{Binding Diagnostics}" />
						<DataGridTextColumn Header="Updated" Width="Auto" MinWidth="165" Binding="{Binding UpdatedUtc}" />
					</DataGrid.Columns>
				</DataGrid>
			</Grid>
		</Border>

	</Grid>
</UserControl>